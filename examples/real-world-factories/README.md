# Real-World Factories Example

This example demonstrates a real-world use case for barrel generation with complex variable transformations and directory scanning.

## Scenario

You have a monorepo with multiple packages, each containing factory utilities for testing. You want to create a centralized barrel file that exports all factory classes with standardized naming.

## Configuration

The `barrel.config.json` uses complex variable transformations:

```json
{
  "version": "1.0",
  "barrels": [
    {
      "name": "factories",
      "output": "./src/barrel-exports/factories.ts",
      "template": {
        "name": "variable-template",
        "export": "export * as {dirName:trimPrefix:warehouse-,ops-|singular|pascal}Factory from '../../packages/{dirName:raw}/test-utils/factory.js'"
      }
    }
  ]
}
```

### Variable Transformations Explained

- `{dirName:trimPrefix:warehouse-,ops-|singular|pascal}`: 
  - Remove `warehouse-` or `ops-` prefixes from directory names
  - Convert to singular form (removes trailing 's')
  - Convert to PascalCase
  - Add 'Factory' suffix

- `{dirName:raw}`: Use the original directory name without any transformations

## Directory Structure

```
examples/real-world-factories/
├── barrel.config.json
├── README.md
├── packages/
│   ├── warehouse-products/
│   │   └── test-utils/
│   │       └── factory.ts    # ProductFactory exports
│   ├── ops-notifications/
│   │   └── test-utils/
│   │       └── factory.ts    # NotificationFactory exports
│   └── user-management/
│       └── test-utils/
│           └── factory.ts    # UserFactory exports
└── src/
    └── barrel-exports/
        └── factories.ts      # Generated barrel file
```

## Expected Output

When running `npx ollypop generate`, the generated `./src/barrel-exports/factories.ts` should contain:

```typescript
// This file is auto-generated by @validkeys/ollypop-ts
// Do not edit this file manually - your changes will be overwritten

export * as ProductFactory from '../../packages/warehouse-products/test-utils/factory.js'
export * as NotificationFactory from '../../packages/ops-notifications/test-utils/factory.js'
export * as UserManagementFactory from '../../packages/user-management/test-utils/factory.js'
```

## Transformation Examples

| Directory Name | Raw | After Transformations | Final Export |
|----------------|-----|----------------------|--------------|
| `warehouse-products` | `warehouse-products` | `Product` | `ProductFactory` |
| `ops-notifications` | `ops-notifications` | `Notification` | `NotificationFactory` |
| `user-management` | `user-management` | `UserManagement` | `UserManagementFactory` |

**Note**: The `singular` transformation didn't affect `user-management` because the inflection library doesn't recognize it as a plural form.

## Usage in Tests

After generation, you can import all factories from one place:

```typescript
import { 
  ProductFactory, 
  NotificationFactory, 
  UserFactory 
} from './src/barrel-exports/factories.js';

// Use in tests
const user = UserFactory.createAdmin();
const product = ProductFactory.create({ category: 'electronics' });
const notification = NotificationFactory.createUrgent({
  recipient: user.email,
  message: `New product available: ${product.name}`
});
```

## Running the Example

From the real-world-factories directory:

```bash
npx ollypop generate
```

Or from the project root:

```bash
pnpm run example:real-world
```

## Debugging

This example tests:
- Directory scanning with `{dirName}` variables
- Complex chained transformations (`trimPrefix|singular|pascal`)
- Parent directory path resolution (`../../packages/`)
- Multiple transformation parameters (`trimPrefix:warehouse-,ops-`)

**Original Issue**: The template engine initially blocked parent directory references (`../`) with the error "Export templates cannot use parent directory references (../)".

**Solution**: Updated the template engine to properly resolve parent directory references relative to the output file's directory using `path.resolve()`.

**Path Resolution**: From output file `./src/barrel-exports/factories.ts`, the path `../../packages/` correctly resolves to `./packages/` in the project root.
